#/bin/sh

VERSION=`date +%y.%m.%d`
PACKAGE=solr.deb_${VERSION}.deb
DEBIAN_VERSION=stable
BUILDDIR=/tmp/solr-$$.deb

echo "Building ${PACKAGE} in temp directory ${BUILDDIR}"

# since this script is in build/deb, the basedir with sources, configs and files is two directories up
BASEDIR=`dirname "$0"`
BASEDIR="${BASEDIR}/../../"

# if not yet there, download Solr binary release
if [ ! -f "${BASEDIR}/usr/src/solr-7.7.2.tgz" ]; then
    echo "Downloading Solr"
    wget -P ${BASEDIR}/usr/src/ https://www-eu.apache.org/dist/lucene/solr/7.7.2/solr-7.7.2.tgz
fi

mkdir ${BUILDDIR}
cp -a ${BASEDIR}/build/deb/${DEBIAN_VERSION}/* ${BUILDDIR}/
cp -a ${BASEDIR}/etc ${BUILDDIR}/
cp -a ${BASEDIR}/var ${BUILDDIR}/
cp -a ${BASEDIR}/usr ${BUILDDIR}/

# Build deb
dpkg -b ${BUILDDIR} ${PACKAGE}
